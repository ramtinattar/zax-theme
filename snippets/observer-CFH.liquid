{% if observer %}
    <script>const observerCFH=new MutationObserver(e=>{e.forEach(({addedNodes:e})=>{e.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE&&"SCRIPT"===e.tagName){let{innerHTML:t,className:a,src:n}=e;t.includes("asyncLoad")&&(e.innerHTML=t.replace("if(window.attachEvent)","document.addEventListener('asyncLazyLoad', event => { asyncLoad(); });if(window.attachEvent)").replaceAll(", asyncLoad",", () => {}")),t.includes("PreviewBarInjector")&&(e.innerHTML=t.replace("DOMContentLoaded","asyncLazyLoad")),"analytics"===a&&(e.type="text/lazyload");(n.includes("assets/storefront/features")||n.includes("assets/shopify_pay")||n.includes("connect.facebook.net"))&&(e.setAttribute("data-src",n),e.removeAttribute("src"))}})})});observerCFH.observe(document.documentElement,{childList:!0,subtree:!0});</script>
{% elsif launchevent %}
    <script>let scriptLoaded=!1;function loadJSscripts(){scriptLoaded||(observerCFH.disconnect(),scriptLoaded=!0,Array.from(document.getElementsByTagName("script")).forEach(t=>{let e=t.getAttribute("data-src");if(null!==e&&(t.setAttribute("src",e),delete t.dataset.src),"text/lazyload"===t.getAttribute("type")){let a=document.createElement("script");Array.from(t.attributes).forEach(t=>{a.setAttribute(t.name,t.value)}),a.type="text/javascript",a.innerHTML=t.innerHTML;let r=t.parentNode;r&&r.replaceChild(a,t)}}),Array.from(document.getElementsByTagName("link")).forEach(t=>{let e=t.getAttribute("data-href");null!==e&&(t.setAttribute("href",e),delete t.dataset.href)}),document.dispatchEvent(new CustomEvent("asyncLazyLoad")))}const activityEvents=["mousedown","mousemove","keydown","scroll","touchstart","click","keypress","touchmove"];activityEvents.forEach(t=>{window.addEventListener(t,loadJSscripts,!1)}),window.addEventListener?window.addEventListener("load",()=>{},!1):window.attachEvent?window.attachEvent("onload",()=>{}):window.onload=()=>{};</script>
    <script>const loadResources=()=>{let e=document.getElementsByTagName("iframe");for(let t of e){let r=t.getAttribute("lazy-src");r&&(t.setAttribute("src",r),t.removeAttribute("lazy-src"))}let s=document.getElementsByTagName("video");for(let a of s){let l=a.getAttribute("lazy-src");l&&(a.setAttribute("src",l),a.removeAttribute("lazy-src"))}},elementInViewport=e=>{let t=e.offsetTop,r=e.offsetLeft,s=e.offsetWidth,a=e.offsetHeight;for(;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&r<window.pageXOffset+window.innerWidth&&t+a>window.pageYOffset&&r+s>window.pageXOffset},lazyLoadImage=()=>{let e=document.getElementsByTagName("img");for(let t of e){let r=t.getAttribute("lazy-src"),s=t.getAttribute("lazy-srcset");r&&(t.setAttribute("src",r),t.removeAttribute("lazy-src")),s&&(t.setAttribute("srcset",s),t.removeAttribute("lazy-srcset"))}let a=document.querySelectorAll("[lazy-bg]");for(let l of a){let o=l.getAttribute("lazy-bg");o&&(l.style.backgroundImage=`url(${o})`,l.removeAttribute("lazy-bg"))}},LoadImagesInit=()=>{let e=document.getElementsByTagName("img");for(let t of e)if(elementInViewport(t)){let r=t.getAttribute("lazy-src"),s=t.getAttribute("lazy-srcset");r&&(t.setAttribute("src",r),t.removeAttribute("lazy-src")),s&&(t.setAttribute("srcset",s),t.removeAttribute("lazy-srcset"))}};LoadImagesInit();const eventListeners=["click","scroll","mouseover","keydown","touchmove","touchstart","wheel"];eventListeners.forEach(e=>{document.addEventListener(e,()=>{let e=document.getElementsByTagName("body")[0];e.getAttribute("lazyLoaded")?lazyLoadImage():(loadResources(),lazyLoadImage(),e.setAttribute("lazyLoaded","1"))})});</script>
{% endif %}

{% comment %}
Voici comment lazyloader du contenu :
- Pour le content_for_header, rien Ã  faire c'est automatique
- Pour les images, iframes, videos : src --> lazy-src
- Pour les backgrounds : [lazy-bg="ma-src"]
- Pour les styles : --> href --> data-href
- Pour les scripts-inlines : --> remplacer "type="text/javasript" par "type="text/lazyload"
- Pour les scripts externes : src --> data-src
{% endcomment %}

